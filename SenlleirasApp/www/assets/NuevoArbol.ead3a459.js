import{z as P,a as F,A as T,k as _,g as B,c as t,b as o,p as z,d as b,w as I,q as u,B as D,C as g,F as f,e as h,f as v,t as m,s as M,i as q,r as w,o as r,D as $}from"./index.90139639.js";import{T as L}from"./TheUploader.4775a76a.js";import{T as G}from"./TheGeolocationComponent.62266f76.js";import"./plugin-vue_export-helper.21dcd24c.js";const O={class:"form-container"},Z={key:0,class:"succes-public"},j={class:"alert-succes"},H={key:0,class:"cargando"},J=o("p",null,"Cargando...",-1),K=[J],Q={key:1,class:"exito"},R=o("p",{class:"txt"},"A \xE1rbore foi publicada correctamente",-1),W=["onSubmit"],X={class:"h2-background"},Y=o("h2",null,"Engadir nova \xE1rbore ",-1),ee={class:"data-senlleira --localizacion"},oe=o("legend",null," Datos da \xE1rbore ",-1),se={class:"senlleira-nombre-cientifico"},ae=o("label",{for:"arbore",class:"form-label"},[q(" Nome da \xE1rbore "),o("span",{class:"required-user","data-set":"Campo obligatorio"},"*")],-1),te=o("label",{for:"especie",class:"form-label"},[q("Nome cient\xEDfico "),o("span",{"data-set":"Campo obligatorio",class:"required-user"},"*")],-1),re=o("option",{value:"#"},null,-1),ne=["value"],le=o("label",{for:"nome",class:"form-label"}," Nome en galego",-1),ie=["value"],ce=o("label",{for:"nome",class:"form-label"}," Nome en castel\xE1n",-1),de=["value"],ue={class:"data-senlleira"},me=o("legend",null,"Ubicaci\xF3n",-1),_e={class:"senlleira-localizacion"},pe=o("label",{for:"zona",class:"form-label"},[q(" Zona xeogr\xE1fica "),o("span",{"data-set":"Campo obligatorio",class:"required-user"},"*")],-1),be=o("label",{for:"localizacion",class:"form-label"},[q(" Ubicaci\xF3n "),o("span",{"data-set":"Campo obligatorio",class:"required-user"},"*")],-1),ge=o("option",{value:"#"},null,-1),fe=o("option",{value:"#"},"Outros",-1),he=["value"],ve={class:"data-senlleira"},qe=o("legend",null,"Descrici\xF3n",-1),ye={class:"senlleira-localizacion"},ke=o("legend",null," Imaxe ",-1),xe={class:"data-senlleira"},Ce={key:0,class:"error"},Ee={key:0,class:"spinner"},ze=["disabled"],Ne={__name:"NuevoArbol",setup(De){const c=P(),V=F(),p=T(),y=_(!1);V.setParques(),p.setArbores();const e=B({genero:"",especie:"",idEspecie:0,idParque:0,ubicacion_parque:"",zona_geografica:"",senlleira:!1,propuesta_senlleira:!1,nombre_arbol:"",nombre_comun:"",nombre_comun_gal:"",storage_ref:"",google_url:"",lng:"",lat:"",diametro:0,altura:0,descripcion:"",publicado:!1});$("form",e);const l=_({error:!1,message:""});let i=null;const k=_(!1),A=_(!0),x=_(!1),U=()=>{e.genero="",e.especie="",e.idEspecie=0,e.idParque=0,e.ubicacion_parque="",e.zona_geografica="",e.senlleira=!1,e.propuesta_senlleira=!1,e.nombre_arbol="",e.nombre_comun="",e.nombre_comun_gal="",e.storage_ref="",e.google_url="",e.lng="",e.lat="",e.diametro=0,e.altura=0,e.descripcion="",e.publicado=!1},C=n=>{if(c.especies.length){const s=c.especies.find(d=>d.idDoc==n.target.value);e.genero=s==null?void 0:s.genero,e.especie=s==null?void 0:s.especie,e.nombre_comun=s==null?void 0:s.nombre_comun,e.nombre_comun_gal=s==null?void 0:s.nombre_comun_gal}},N=async n=>{try{l.value={error:!1,message:""},i=n}catch(s){l.value.error=!0,l.value.message=s.message}},S=async()=>{y.value=!0;const n=await p.insertarArbore(e,i[0].name);if(c.especies.length){try{if(i===null||!i.length)throw new Error("Falta imagen")}catch(s){l.value.error=!0,l.value.message=s.message}if(i!==null&&n.id)try{l.value={error:!1,message:""},k.value=!0,x.value=!0;for(let d=0,E=i.length;d<E;d++)await p.subirFoto({ref:`Arbores/${n.id}`,file:i[d]});const s=`Arbores/${n.id}/${i[0].name}`;await p.google_url_save(n.id,s),k.value=!1,U()}catch(s){l.value.error=!0,l.value.message=s.message}finally{A.value=!1,y.value=!1}}};return c.setEspecies().then().catch(n=>alert(n)),(n,s)=>{const d=w("icono"),E=w("router-link");return r(),t("div",O,[x.value?(r(),t("div",Z,[o("div",j,[A.value?(r(),t("div",H,K)):(r(),t("div",Q,[R,o("button",{class:"btn-succes",onClick:s[0]||(s[0]=a=>x.value=!1)},"Volver ao inicio")]))])])):z("",!0),o("form",{id:"senlleiras",method:"post",enctype:"multipart/form-data",onSubmit:M(S,["prevent"])},[o("span",X,[Y,b(E,{to:"/"},{default:I(()=>[b(d,{icon:["fa","xmark"]})]),_:1})]),o("fieldset",ee,[oe,o("div",se,[ae,u(o("input",{"onUpdate:modelValue":s[1]||(s[1]=a=>e.nombre_arbol=a),type:"text",name:"arbore",id:"arbore",placeholder:"indica o nome da arbore",required:""},null,512),[[D,e.nombre_arbol]]),te,u(o("select",{onChange:C,"onUpdate:modelValue":s[2]||(s[2]=a=>e.idEspecie=a),name:"especie",id:"especie",required:""},[re,(r(!0),t(f,null,h(v(c).especies,a=>(r(),t("option",{class:"especie-option",key:a.idDoc,value:a.idDoc},m(a.genero)+" "+m(a.especie),9,ne))),128))],544),[[g,e.idEspecie]]),le,u(o("select",{onChange:C,"onUpdate:modelValue":s[3]||(s[3]=a=>e.idEspecie=a),name:"nome",id:"nombre-gallego"},[(r(!0),t(f,null,h(v(c).especies,a=>(r(),t("option",{key:a.idDoc,value:a.idDoc},m(a.nombre_comun_gal),9,ie))),128))],544),[[g,e.idEspecie]]),ce,u(o("select",{onChange:C,"onUpdate:modelValue":s[4]||(s[4]=a=>e.idEspecie=a),name:"nome",id:"nombre-castellano"},[(r(!0),t(f,null,h(v(c).especies,a=>(r(),t("option",{key:a.idDoc,value:a.idDoc},m(a.nombre_comun),9,de))),128))],544),[[g,e.idEspecie]])])]),o("fieldset",ue,[me,o("div",_e,[pe,u(o("input",{"onUpdate:modelValue":s[5]||(s[5]=a=>e.zona_geografica=a),type:"text",name:"zona",id:"zona",placeholder:"Lugar onde esta a arbore"},null,512),[[D,e.zona_geografica]]),be,u(o("select",{onChange:s[6]||(s[6]=a=>e.ubicacion_parque=a.target.options[a.target.selectedIndex].text),"onUpdate:modelValue":s[7]||(s[7]=a=>e.idParque=a),name:"localizacion",id:"localizacion",required:""},[ge,fe,(r(!0),t(f,null,h(v(V).parques,a=>(r(),t("option",{key:a.idDoc,value:a.idDoc},m(a.nombre),9,he))),128))],544),[[g,e.idParque]]),b(G)])]),o("fieldset",ve,[qe,o("div",ye,[u(o("textarea",{"onUpdate:modelValue":s[8]||(s[8]=a=>e.descripcion=a),name:"descripcion",id:"descripcion",cols:"30",rows:"10",placeholder:"breve descripci\xF3n da \xE1rbore"},null,512),[[D,e.descripcion]])])]),o("fieldset",null,[ke,o("div",xe,[b(L,{onEmitirFichero:N}),l.value.error?(r(),t("div",Ce,m(l.value.message),1)):z("",!0)]),k.value?(r(),t("div",Ee," Cargando.... ")):z("",!0)]),o("button",{disabled:y.value,class:"btn-form"},"Publicar Arbore",8,ze)],40,W)])}}};export{Ne as default};
